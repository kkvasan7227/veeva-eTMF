<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>


<body>
    <video autoplay loop muted play-inline class="back-video"> <source src="images/video1.mp4" type="video/mp4"></video>
    
    <div class="container">
        <div id="search-section">
            <h1 style="color: aliceblue;">Veeva eTMF</h1>
            <input type="text" id="search-input" placeholder="Search ETMF Object...." class="search-bar" required>
            <button class="search-button" onclick="performLogin()()">Search</button>
            <div id="error-message" style="color: red; margin-top: 10px;"></div>
			<div id="table-container"></div>
            <div id="login-error-message" style="color: red; margin-top: 20px;"></div>
        </div>

        

        <table id="metadata-table">
            <tr>
                <th>Label</th>
                <th>Object Name</th>
                <th>Status</th>
                <th>Configuration State</th>
				<th>Description</th>
            </tr>
        </table>
    </div>

    <script>
        


        async function performLogin() {
		
		const query = document.getElementById('search-input').value.trim().toLowerCase();

            // Check if the entered query is "etmf"
            if (query === 'etmf') {
                // Hide the search section and show the login section
                document.getElementById('search-section').style.display = 'none';
                
                document.getElementById('error-message').innerText = ''; // Clear any previous error message
            } else {
                document.getElementById('error-message').innerText = 'Error: Please enter "ETMF" to proceed.';
            } 
			
            const username = 'prana.user3@partnersi-prana4life.com';
            const password = 'Pr4n4U$er333!';

            const formData = new URLSearchParams();
            formData.append('username', username);
            formData.append('password', password);

            try {
                // Login request
                const loginResponse = await fetch('https://cors-anywhere.herokuapp.com/https://partnersi-prana4life-clinical.veevavault.com/api/v24.1/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData
                });

                if (!loginResponse.ok) throw new Error('Login failed');
                const loginData = await loginResponse.json();
                const sessionId = loginData.sessionId;

                // Metadata request
                const metadataResponse = await fetch('https://cors-anywhere.herokuapp.com/https://partnersi-prana4life-clinical.veevavault.com/api/v24.1/metadata/vobjects', {
                    method: 'GET',
                    headers: {
                        'Authorization': sessionId,
                        'Accept': 'application/json'
                    }
                });

                if (!metadataResponse.ok) throw new Error('Metadata fetch failed');
                const metadata = await metadataResponse.json();

                // Display metadata in table format
                displayMetadataInTable(metadata.objects);

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('login-error-message').innerText = error.message;
            }
        }

        function displayMetadataInTable(objects) {
            const tableContainer = document.getElementById('metadata-table');
            const rows = objects.filter(obj => obj.name.endsWith('__clin')).map(obj => `
                <tr>
                    <td>${obj.label}</td>
                    <td>${obj.name}</td>
                    <td>${obj.status.join(', ')}</td>
                    <td>${obj.configuration_state}</td>
					<td>${obj.description}</td>
                </tr>
            `).join('');

            tableContainer.innerHTML += rows; 
            tableContainer.style.display = 'table';
        }
    </script>
</body>


</html>
